/*
 Copyright (c) 2015, Ben Schulz
 License: BSD 3-clause (http://opensource.org/licenses/BSD-3-Clause)
*/
function v(q,r){return function(n,g,p,a){var b=[38,37,39,40,9,13];a.defineExtension("ko-grid-cell-navigation",{initializer:function(a){a.before("table").insert('<textarea class="ko-grid-focus-parking" tabIndex="-1" style="position: absolute; z-index: 10; overflow: hidden; box-sizing: border-box; width: 1em; height: 1em; top: -3em; left: -3em; resize: none; border: none;"></textarea>')},Constructor:function(a,n,f){function h(d,e,a){a=!!a;var b=f.data.rows.displayed(),l=f.columns.displayed(),c=NaN+
d,k=l.indexOf(t)+e;a&&0>k?(--c,k=l.length-1):a&&k>=l.length&&(c+=1,k=0);1==d&&f.B.A&&c>=b.length&&(f.B.A(),setTimeout(function(){h(d,e,a)},100));k=Math.max(0,Math.min(l.length-1,k));c=Math.max(0,Math.min(b.length-1,c));w(b.get(c),l[k])}function w(a,e){var d=f.data.lookupCell(a,e);a===x&&e===t||q(a,e,d);if(!p.s(f.rootElement,window.document.activeElement)){var b=d.element.querySelector("input, select, textarea");b||(m.value=e.renderValue(g.unwrap(-1==e.property.indexOf(".")?a[e.property]:eval("row."+
e.property))),m.setSelectionRange(0,m.value.length),b=m);window.chrome||b.focus()}r(d.element)}function q(a,b,c){u&&u.release();u=c.hijack(function(d){return y.reduce(function(d,e){return e(a,b,d)||d},{init:function(a,b,e){var c=arguments;x=b;t=e;d.init.apply(this,c);a.classList.add("focused")},update:function(a){d.update.apply(this,arguments);a.classList.add("focused")}})})}function r(a){var b=c.getBoundingClientRect();a=a.getBoundingClientRect();var d=Math.min(0,a.top-b.top-7)||Math.max(0,a.bottom-
b.bottom+7+(c.offsetHeight-c.clientHeight));c.scrollLeft+=Math.min(0,a.left-b.left-7)||Math.max(0,a.right-b.right+7+(c.offsetWidth-c.clientWidth));c.scrollTop+=d}var y=[];this.onCellFocused=this.u=function(a){return y.push(a)};var c=null,m=null,x=null,t=null,u=null;f.postApplyBindings(function(){c=f.element.querySelector(".ko-grid-table-scroller");m=f.element.querySelector(".ko-grid-focus-parking")});f.data.onCellClick(function(a,b,c,f){return w(c,f)});f.onKeyDown(function(a){if(!(a.defaultPrevented||
0>b.indexOf(a.keyCode))){a.preventDefault();var c=a.shiftKey?-1:1;switch(a.keyCode){case 38:return h(-1,0);case 37:return h(0,-1);case 39:return h(0,1);case 40:return h(1,0);case 9:return h(0,c,!0);case 13:return h(0,c,!0)}}})}});return a.declareExtensionAlias("cellNavigation","ko-grid-cell-navigation")}({},r,function(){return function(){function n(a,b){return!!(a.compareDocumentPosition(b)&16)}var g=window.Element,p=g.prototype.webkitMatchesSelector||g.prototype.mozMatchesSelector||g.prototype.msMatchesSelector||
g.prototype.matches;return{C:function(a,b){for(var g=0;b;){if(b===a)return g;b=b.parentNode;++g}throw Error("The given node is not part of the subtree.");},s:function(a,b){return a===b||n(a,b)},F:n,element:{closest:function(a,b){do{if(p.call(a,b))return a;a=a.parentElement}while(a);return null},matches:function(a,b){return p.call(a,b)}}}}()}(),q)}
"function"===typeof define&&define.amd?define(["ko-grid","knockout","ko-data-source","ko-indexed-repeat"],v):window["ko-grid-cell-navigation"]=v(window.ko.bindingHandlers.grid,window.ko);